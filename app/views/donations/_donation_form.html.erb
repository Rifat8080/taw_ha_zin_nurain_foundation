<%= form_with model: donation, local: true, class: "space-y-4" do |form| %>
  <% if donation.errors.any? %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      <h3 class="font-bold">Error! Please fix the following issues:</h3>
      <ul class="list-disc list-inside">
        <% donation.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :amount, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.number_field :amount, 
        step: 0.01,
        class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500", 
        placeholder: "Enter donation amount" %>
  </div>

  <% unless current_user %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <%= form.label :first_name, class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :first_name, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500", 
            placeholder: "First Name" %>
      </div>

      <div>
        <%= form.label :last_name, class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :last_name, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500", 
            placeholder: "Last Name" %>
      </div>
    </div>

    <div>
      <%= form.label :email, class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.email_field :email, 
          class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500", 
          placeholder: "Email Address" %>
    </div>

    <div>
      <%= form.label :phone_number, class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.telephone_field :phone_number, 
          class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500", 
          placeholder: "Phone Number" %>
    </div>

    <div>
      <%= form.label :address, class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_area :address, 
          rows: 2,
          class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500", 
          placeholder: "Address" %>
    </div>
  <% else %>
    <div class="bg-green-50 border border-green-200 rounded-md p-3">
      <p class="text-sm text-green-700">
        <strong>Donating as:</strong> <%= current_user.full_name %> (<%= current_user.email %>)
      </p>
    </div>
  <% end %>

  <div>
    <%= form.label :project_id, "Project", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.select :project_id, 
        options_from_collection_for_select(projects, :id, :name, donation.project_id), 
        { prompt: "Select a project to support" }, 
        { class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" } %>
    <% if projects.empty? %>
      <p class="mt-2 text-sm text-red-600">No projects are currently accepting donations.</p>
    <% else %>
      <p class="mt-2 text-sm text-gray-500">Only active projects accepting donations are shown.</p>
    <% end %>
  </div>

  <div class="flex justify-between pt-4">
    <%= form.submit submit_text, 
        class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded transition duration-200" %>
    <% if defined?(show_cancel) && show_cancel %>
      <%= link_to "Cancel", donations_path, 
          class: "bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded transition duration-200" %>
    <% end %>
  </div>
<% end %>
