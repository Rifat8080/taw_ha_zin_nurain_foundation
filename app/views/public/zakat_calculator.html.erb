<% content_for :title, "Zakat Calculator" %>

<div class="min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-purple-50">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-12">
      <div class="inline-flex items-center justify-center w-20 h-20 bg-foundationprimarygreen rounded-full mb-6">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
        </svg>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        Zakat <span class="text-foundationprimarygreen">Calculator</span>
      </h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto mb-6">
        Calculate your Zakat obligations based on Islamic principles. Zakat is one of the Five Pillars of Islam.
      </p>
      
      <!-- Current Nisab Information -->
      <% if @current_nisab_rate %>
        <div class="inline-flex items-center px-6 py-3 bg-blue-100 text-blue-800 rounded-lg font-semibold">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Current Nisab Threshold: $<%= number_with_delimiter(@nisab_value, precision: 0) %>
        </div>
      <% end %>
    </div>

    <!-- Calculator Form -->
    <div class="max-w-4xl mx-auto">
      <%= form_with url: calculate_zakat_path, method: :post, local: true, class: "bg-white rounded-xl shadow-lg overflow-hidden" do |form| %>
        <div class="bg-foundationprimarygreen text-white px-8 py-6">
          <h2 class="text-2xl font-bold">Enter Your Financial Information</h2>
          <p class="mt-2 opacity-90">Please provide accurate information for proper Zakat calculation</p>
        </div>

        <div class="p-8">
          <div class="grid md:grid-cols-2 gap-8">
            <!-- Assets Section -->
            <div class="space-y-6">
              <div class="border-b border-gray-200 pb-4">
                <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                  <svg class="w-6 h-6 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v2"></path>
                  </svg>
                  Assets (What You Own)
                </h3>
                <p class="text-gray-600 mt-1">Enter the current value of your assets</p>
              </div>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Cash & Bank Savings ($)</label>
                  <%= form.number_field "assets[cash]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @assets&.dig('cash'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" %>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Gold & Silver ($)</label>
                  <%= form.number_field "assets[precious_metals]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @assets&.dig('precious_metals'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" %>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Investments & Stocks ($)</label>
                  <%= form.number_field "assets[investments]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @assets&.dig('investments'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" %>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Business Inventory ($)</label>
                  <%= form.number_field "assets[business_inventory]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @assets&.dig('business_inventory'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" %>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Money Owed to You ($)</label>
                  <%= form.number_field "assets[receivables]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @assets&.dig('receivables'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" %>
                </div>
              </div>
            </div>

            <!-- Liabilities Section -->
            <div class="space-y-6">
              <div class="border-b border-gray-200 pb-4">
                <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                  <svg class="w-6 h-6 mr-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                  </svg>
                  Liabilities (What You Owe)
                </h3>
                <p class="text-gray-600 mt-1">Enter your current debts and obligations</p>
              </div>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Credit Card Debt ($)</label>
                  <%= form.number_field "liabilities[credit_card]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @liabilities&.dig('credit_card'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" %>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Personal Loans ($)</label>
                  <%= form.number_field "liabilities[personal_loans]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @liabilities&.dig('personal_loans'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" %>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Money You Owe ($)</label>
                  <%= form.number_field "liabilities[payables]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @liabilities&.dig('payables'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" %>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Other Debts ($)</label>
                  <%= form.number_field "liabilities[other_debts]", 
                      placeholder: "0.00", 
                      step: "0.01",
                      value: @liabilities&.dig('other_debts'),
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" %>
                </div>

                <!-- Calculate Button -->
                <div class="pt-4">
                  <%= form.submit "Calculate My Zakat", 
                      class: "w-full bg-foundationprimarygreen hover:bg-opacity-90 text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg" %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Results Section -->
      <% if @total_assets && @total_assets > 0 %>
        <div class="mt-8 bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="bg-gradient-to-r from-foundationprimarygreen to-green-600 text-white px-8 py-6">
            <h2 class="text-2xl font-bold">Your Zakat Calculation Results</h2>
          </div>
          
          <div class="p-8">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              <div class="text-center p-6 bg-blue-50 rounded-lg">
                <div class="text-3xl font-bold text-blue-600">$<%= number_with_delimiter(@total_assets, precision: 0) %></div>
                <div class="text-sm text-blue-700 mt-1">Total Assets</div>
              </div>
              
              <div class="text-center p-6 bg-red-50 rounded-lg">
                <div class="text-3xl font-bold text-red-600">$<%= number_with_delimiter(@total_liabilities, precision: 0) %></div>
                <div class="text-sm text-red-700 mt-1">Total Liabilities</div>
              </div>
              
              <div class="text-center p-6 bg-purple-50 rounded-lg">
                <div class="text-3xl font-bold text-purple-600">$<%= number_with_delimiter(@net_assets, precision: 0) %></div>
                <div class="text-sm text-purple-700 mt-1">Net Wealth</div>
              </div>
              
              <div class="text-center p-6 <%= @zakat_eligible ? 'bg-green-50' : 'bg-gray-50' %> rounded-lg">
                <div class="text-3xl font-bold <%= @zakat_eligible ? 'text-green-600' : 'text-gray-600' %>">
                  $<%= number_with_delimiter(@zakat_due, precision: 0) %>
                </div>
                <div class="text-sm <%= @zakat_eligible ? 'text-green-700' : 'text-gray-700' %> mt-1">Zakat Due</div>
              </div>
            </div>

            <div class="text-center">
              <% if @zakat_eligible %>
                <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                  <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <h3 class="text-2xl font-bold text-green-800 mb-2">✨ Zakat is Due!</h3>
                  <p class="text-green-700 text-lg">
                    Your wealth exceeds the Nisab threshold. You should pay <strong>$<%= number_with_delimiter(@zakat_due, precision: 0) %></strong> as Zakat.
                  </p>
                  <p class="text-green-600 mt-2">May Allah accept your Zakat and bless your wealth.</p>
                </div>

                <!-- Payment Options -->
                <div class="grid md:grid-cols-2 gap-4 mt-6">
                  <%= link_to projects_path(filter: { categories: "Palestine" }), 
                      class: "flex items-center justify-center px-6 py-4 bg-foundationprimarygreen hover:bg-opacity-90 text-white font-semibold rounded-lg transition-all duration-200 transform hover:scale-105" do %>
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>
                    Pay Zakat Through Our Projects
                  <% end %>

                  <% if user_signed_in? %>
                    <%= link_to new_zakat_calculation_path, 
                        class: "flex items-center justify-center px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-200" do %>
                      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v8a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                      </svg>
                      Save Detailed Calculation
                    <% end %>
                  <% else %>
                    <%= link_to new_user_registration_path, 
                        class: "flex items-center justify-center px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-200" do %>
                      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                      </svg>
                      Create Account to Track Zakat
                    <% end %>
                  <% end %>
                </div>
              <% else %>
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                  <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <h3 class="text-2xl font-bold text-gray-800 mb-2">No Zakat Due</h3>
                  <p class="text-gray-600 text-lg">
                    Your wealth is below the Nisab threshold of <strong>$<%= number_with_delimiter(@nisab_value, precision: 0) %></strong>.
                  </p>
                  <p class="text-gray-600 mt-2">Zakat is not required, but voluntary charity (Sadaqah) is always encouraged.</p>
                  
                  <div class="mt-4">
                    <%= link_to projects_path(filter: { categories: "Sadaqah" }), 
                        class: "inline-flex items-center px-6 py-3 bg-foundationprimarygreen hover:bg-opacity-90 text-white font-semibold rounded-lg transition-all duration-200" do %>
                      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                      </svg>
                      Give Voluntary Charity
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Information Section -->
      <div class="mt-8 grid md:grid-cols-3 gap-6">
        <div class="bg-white rounded-lg shadow-md p-6">
          <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">What is Nisab?</h3>
          <p class="text-gray-600 text-sm">Nisab is the minimum threshold of wealth that makes a Muslim liable to pay Zakat. It's equivalent to 85 grams of gold or 595 grams of silver.</p>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
          <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Zakat Rate</h3>
          <p class="text-gray-600 text-sm">Zakat is calculated at 2.5% (1/40th) of your qualifying wealth that has been in your possession for a full lunar year.</p>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
          <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Blessed Giving</h3>
          <p class="text-gray-600 text-sm">Paying Zakat purifies your wealth and brings Allah's blessings. It helps support those in need and strengthens the community.</p>
        </div>
      </div>
    </div>
  </div>
</div>
